function shouldProcessDate(n,{ngay:t,thang:o,nam:u}){let e=new Date(n);return(null==t||e.getDay()==t)&&(null==o||e.getMonth()==o)&&(null==u||e.getFullYear()==u)}function thongKeSanPham({ngay:n,thang:t,nam:o}={}){return Object.entries(g_hoaDon.reduce((u,e)=>(shouldProcessDate(e["ngay-tao"],{ngay:n,thang:t,nam:o})&&e["chi-tiet"].forEach(n=>{let t=n["san-pham"];u[t]=(u[t]??0)+n["so-luong"]}),u),{})).map(([n,t])=>{let o=timSanPham(n);return{...o,"so-luong":t,"tong-thu":t*o["price-sale-n"]}})}function topSanPhamDoanhThu({ngay:n,thang:t,nam:o}={}){return thongKeSanPham({ngay:n,thang:t,nam:o}).sort((n,t)=>t["so-luong"]-n["so-luong"])}function topSanPhamDoanhThu({ngay:n,thang:t,nam:o}={}){return thongKeSanPham({ngay:n,thang:t,nam:o}).sort((n,t)=>t["tong-thu"]-n["tong-thu"])}function thongKeNguoiDung({ngay:n,thang:t,nam:o}={}){return Object.entries(g_hoaDon.reduce((u,e)=>{if(!shouldProcessDate(e["ngay-tao"],{ngay:n,thang:t,nam:o}))return u;let a=e["nguoi-dung"];return u[a]||(u[a]={"tieu-thu":{},"so-don":0}),u[a]["so-don"]+=1,e["chi-tiet"].forEach(n=>{let t=n["san-pham"];u[a][["tieu-thu"]][t]=(u[a][["tieu-thu"]][t]??0)+n["so-luong"]}),u},{})).map(([n,t])=>{let o=t["tieu-thu"];return{...timNguoiDung(n),"so-don":t["so-don"],"loai-da-mua":Object.keys(o).length,"da-mua":Object.values(o).reduce((n,t)=>n+t,0),"tong-chi":Object.entries(o).reduce((n,[t,o])=>n+o*timSanPham(t)["price-sale-n"],0)}})}function topKhachLenDon({ngay:n,thang:t,nam:o}={}){return thongKeNguoiDung({ngay:n,thang:t,nam:o}).sort((n,t)=>t["so-don"]-n["so-don"])}function topKhachMuaNhieuLoai({ngay:n,thang:t,nam:o}={}){return thongKeNguoiDung({ngay:n,thang:t,nam:o}).sort((n,t)=>t["loai-da-mua"]-n["loai-da-mua"])}function topKhachMuaNhieu({ngay:n,thang:t,nam:o}={}){return thongKeNguoiDung({ngay:n,thang:t,nam:o}).sort((n,t)=>t["da-mua"]-n["da-mua"])}function topKhachChiTieu({ngay:n,thang:t,nam:o}={}){return thongKeNguoiDung({ngay:n,thang:t,nam:o}).sort((n,t)=>t["tong-chi"]-n["tong-chi"])}taiDuLieu(nguoiDungKey,nguoiDungFile).then(n=>{g_nguoiDung=n,i_nguoiDung=taiDuLieuLocalStorage(nguoiDungImKey)??createIndexMapping(g_nguoiDung,nguoiDungIdKey)}),taiDuLieu(sanPhamKey,sanPhamFile).then(n=>{g_sanPham=n,i_sanPham=taiDuLieuLocalStorage(sanPhamImKey)??createIndexMapping(g_sanPham,sanPhamIdKey)}),taiDuLieu(hoaDonKey,hoaDonFile).then(n=>{g_hoaDon=n,i_hoaDon=taiDuLieuLocalStorage(hoaDonImKey)??createIndexMapping(g_hoaDon,hoaDonIdKey)});